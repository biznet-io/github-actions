name: 'Run Tests'
description: 'Run linting and testing for the project'

inputs:
  is_merge_request:
    description: 'Whether this is a merge request'
    required: false
    default: 'false'
  base_ref:
    description: 'Base reference branch for affected command'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - uses: biznet-io/github-actions/setup-working-directory@v1

    - name: Run tests
      shell: bash
      run: |
        cd ${{ env.WORKING_DIRECTORY }}
        if [ "${{ inputs.is_merge_request }}" = "true" ]; then
          yarn nx affected --base=origin/${{ inputs.base_ref }} --head=HEAD --target="lint,test" --parallel=$NX_MAX_WORKERS
        else
          yarn nx run-many --target="lint,test" --parallel=$NX_MAX_WORKERS
        fi
